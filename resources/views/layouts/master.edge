<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayıt Takip - İlaç Takip</title>
    <link rel="icon" href="as.png">
    {{ style('library/bootstrap/css/bootstrap.min.css') }}
    {{ style('library/datatables/datatables.min.css') }}
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">AS Ecza Deposu - Kayıt Takip</a>
      
        <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ auth.user.username }}
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <form action="{{ '/logout' }}" method="POST">
                            {{ csrfField() }}
                            <button type="submit" class="dropdown-item">Çıkış</a>
                        </form>
                    </div>
                  </li>
            </ul>
        </div>
      </nav>





    <div class="container mt-5 mb-5">
        <button type="button" class="btn btn-success mb-2 float-right" data-toggle="modal" data-target="#exampleModal">Ekle</button>
        <table id="table_id" class="display">
            <thead>
                <tr>
                    <th>Kod</th>
                    <th>İlaç</th>
                    <th>Adet</th>
                    <th>Kim Aldı</th>
                    <th>Kim İçin Aldı</th>
                    <th>Tarih</th>
                    <th>Açıklama</th>
                    <th>İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @each(item in medicines)
                <tr>
                    <td>
                        @if(item.code != null)
                            {{ item.code }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.medicine != null)
                            {{ item.medicine }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.piece != null)
                            {{ item.piece }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.recipient != null)
                            {{ item.recipient }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.for_whom != null)
                            {{ item.for_whom }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.date != null)
                            {{ item.date }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        @if(item.description != null)
                            {{ item.description }}
                        @else
                            ---
                        @endif
                    </td>
                    <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateForm" onclick="dataSendModal('{{ item.id }}', '{{ item.code }}', '{{ item.medicine }}', '{{ item.piece }}', '{{ item.recipient }}', '{{ item.for_whom }}', '{{ item.date }}', '{{ item.description }}')">Düzenle</button>
                        <form action="{{ '/all/' + item.id + '?_method=DELETE' }}" class="form" style="display:inline-block;" method="POST">
                            {{ csrfField() }}
                            <button class="btn btn-danger">Sil</button>
                        </form>
                    </td>
                </tr>
                @endeach
            </tbody>
        </table>

        @if(medicines.length != 0)
        <div class="row">
            <div class="col-md-12 text-center">
                <h3 class="text-danger border border-danger mt-5 pt-3 pb-3 text-center">Tehlikeli İşlem</h3>
                <form action="{{ '/all/deleteAll' + '?_method=DELETE' }}" class="form mt-2" method="POST">
                    {{ csrfField() }}
                    <button class="btn btn-block float-right btn-danger">Tümünü Sil</button>
                </form>
            </div>
        </div>
        @endif
    </div>






    <div class="modal fade" id="updateForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Kayıt Düzenle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="POST" id="update">
                    {{ csrfField() }}
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kod:</label>
                        <input type="text" class="form-control" id="code2" name="code2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">İlaç:</label>
                        <input type="text" class="form-control" id="medicine2" name="medicine2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Adet:</label>
                        <input type="text" class="form-control" id="piece2" name="piece2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kim Aldı:</label>
                        <input type="text" class="form-control" id="recipient2" name="recipient2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kim İçin Aldı:</label>
                        <input type="text" class="form-control" id="for_whom2" name="for_whom2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Tarih:</label>
                        <input type="date" class="form-control" id="date2" name="date2">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Açıklama:</label>
                        <input type="text" class="form-control" id="description2" name="description2">
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Kapat</button>
                <button type="submit" class="btn btn-primary">Güncelle</button>
            </div>
        </form>
            </div>
        </div>
        </div>
{{--  -----------------------------------  --}}
   
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Kayıt Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="{{ '/all/medicine-add' }}" method="POST">
                    {{ csrfField() }}
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kod:</label>
                        <input type="text" class="form-control" id="code" name="code" value="">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">İlaç:</label>
                        <input type="text" class="form-control" id="medicine" name="medicine">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Adet:</label>
                        <input type="text" class="form-control" id="piece" name="piece">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kim Aldı:</label>
                        <input type="text" class="form-control" id="recipient" name="recipient">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Kim İçin Aldı:</label>
                        <input type="text" class="form-control" id="for_whom" name="for_whom">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Tarih:</label>
                        <input type="date" class="form-control" id="date" name="date">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Açıklama:</label>
                        <input type="text" class="form-control" id="description" name="description">
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Kapat</button>
                <button type="submit" class="btn btn-primary">Ekle</button>
            </div>
        </form>
            </div>
        </div>


{{--  -------------------------------------------  --}}



    
    
    
    {{ script('library/jquery.min.js') }}
    {{ script('library/bootstrap/js/bootstrap.min.js') }}
    {{ script('library/datatables/datatables.min.js') }}
    {{ script('library/moment/moment.js') }}

    <script>
        $(document).ready( function () {
            $('#table_id').DataTable();
        });

        function dataSendModal(id, code="", medicine, piece, recipient, for_whom, date, description) {
            
            if(code.toString() != "null"){
                $('#updateForm').find('#code2').val(code);
            }

            if(medicine.toString() != "null"){
                $('#updateForm').find('#medicine2').val(medicine);
            }

            if(piece.toString() != "null"){
                $('#updateForm').find('#piece2').val(piece);
            }

            if(recipient.toString() != "null"){
                $('#updateForm').find('#recipient2').val(recipient);
            }

            if(for_whom.toString() != "null"){
                $('#updateForm').find('#for_whom2').val(for_whom);
            }

            if(date.toString() != "null"){
                $('#updateForm').find('#date2').val(moment(date).format("YYYY/MM/DD").split('/').join('-'));
            }

            if(description.toString() != "null"){
                $('#updateForm').find('#description2').val(description);
            }

            $('#update').attr('action', '/all/medicine-update/' + id + '?_method=PUT')
        }
    </script>
</body>
</html>
